<!doctype html>
{% load static %}
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfolio Charts</title>

  <link rel="stylesheet" href="{% static 'portfolios/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'portfolios/css/charts.css' %}">
</head>

<body>
  <div class="container py-4 py-md-5">
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-4">
      <div>
        <h1 class="h3 mb-1">Portfolio Charts</h1>
        <div class="muted small">
          Vista rapida para explicar el JSON: valor del portafolio, composicion por activo y drawdown.
        </div>
      </div>

      <div class="d-flex gap-2 align-items-center">
        <span class="badge badge-soft rounded-pill px-3 py-2" id="rangeBadge">Rango: --</span>
        <button class="btn btn-outline-primary btn-sm" id="btnReload" type="button">Recargar</button>
      </div>
    </div>

    <div id="statusArea" class="mb-3"></div>

    <div class="row g-3 mb-3">
      <div class="col-6 col-lg-3">
        <div class="card shadow-soft h-100">
          <div class="card-body">
            <div class="small text-uppercase text-muted">Valor final</div>
            <div class="h4 mb-0 kpi" id="kpiValue">--</div>
            <div class="muted small mt-1">Ultimo <span class="mono">V</span> del rango</div>
          </div>
        </div>
      </div>

      <div class="col-6 col-lg-3">
        <div class="card shadow-soft h-100">
          <div class="card-body">
            <div class="small text-uppercase text-muted">Retorno</div>
            <div class="h4 mb-0 kpi" id="kpiReturn">--</div>
            <div class="muted small mt-1">(Vfinal/Vinicial) - 1</div>
          </div>
        </div>
      </div>

      <div class="col-6 col-lg-3">
        <div class="card shadow-soft h-100">
          <div class="card-body">
            <div class="small text-uppercase text-muted">Volatilidad</div>
            <div class="h4 mb-0 kpi" id="kpiVol">--</div>
            <div class="muted small mt-1">Std de retornos (simple)</div>
          </div>
        </div>
      </div>

      <div class="col-6 col-lg-3">
        <div class="card shadow-soft h-100">
          <div class="card-body">
            <div class="small text-uppercase text-muted">Max. drawdown</div>
            <div class="h4 mb-0 kpi" id="kpiDD">--</div>
            <div class="muted small mt-1">Peor caida desde maximo</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-soft mb-3">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-lg-4">
            <h2 class="h6 mb-1">Que trae el JSON</h2>
            <div class="muted small">
              El endpoint devuelve una serie temporal con:
              <ul class="mb-0">
                <li><span class="mono">rows[].date</span>: fecha</li>
                <li><span class="mono">rows[].V</span>: valor total del portafolio en USD</li>
                <li><span class="mono">rows[].weights</span>: pesos por activo (0 a 1)</li>
                <li><span class="mono">assets</span>: lista de activos (claves de weights)</li>
              </ul>
            </div>
          </div>
          <div class="col-lg-8">
            <h2 class="h6 mb-1">Como explicar los graficos</h2>
            <div class="muted small">
              <ol class="mb-0">
                <li><b>Valor V(t)</b>: muestra tendencia del portafolio (sube/baja) en el rango.</li>
                <li><b>Pesos (stacked)</b>: muestra en que activos estabas expuesto y como cambio la mezcla. Siempre suma 100%.</li>
                <li><b>Drawdown</b>: muestra el riesgo de caidas desde maximos; util para explicar periodos de estres.</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-12">
        <div class="card shadow-soft">
          <div class="card-body">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-2">
              <div>
                <h2 class="h5 mb-0">1) Evolucion del valor del portafolio</h2>
                <div class="muted small">
                  Que muestra: <span class="mono">rows[].V</span> a traves del tiempo. Util para ver como rindio.
                </div>
              </div>
              <div class="small text-muted" id="vMeta">--</div>
            </div>
            <div class="chart-wrap"><canvas id="vChart"></canvas></div>
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="card shadow-soft">
          <div class="card-body">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-2">
              <div>
                <h2 class="h5 mb-0">2) Composicion del portafolio (pesos por activo)</h2>
                <div class="muted small">
                  Que muestra: <span class="mono">rows[].weights[asset]</span>. Area apilada: siempre suma 100%.
                </div>
              </div>
              <div class="small text-muted" id="wMeta">--</div>
            </div>
            <div class="chart-wrap"><canvas id="wChart"></canvas></div>
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="card shadow-soft">
          <div class="card-body">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-2">
              <div>
                <h2 class="h5 mb-0">3) Drawdown (caida desde maximos)</h2>
                <div class="muted small">
                  Que muestra: % de caida desde el maximo historico dentro del rango (0% es maximo, negativo es caida).
                </div>
              </div>
              <div class="small text-muted" id="ddMeta">--</div>
            </div>
            <div class="chart-wrap"><canvas id="ddChart"></canvas></div>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4 muted small">
      Nota: KPIs calculados desde V(t) en frontend solo para visualizacion rapida.
    </div>
  </div>

  <script src="{% static 'portfolios/js/chart.umd.min.js' %}" defer></script>
  <script src="{% static 'portfolios/js/charts.js' %}" defer></script>
</body>
</html>
